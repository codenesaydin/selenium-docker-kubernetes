EXPORT_MAVEN_HOME = 'M2_HOME="/opt/apache-maven-3.6.3/"'

pipeline {
    agent any

    /*
    parameters
            {
                choice(choices: ['WEB', 'IOS', 'ANDROID', 'INTEGRATION'], description: '', name: 'PROJECT')
                string defaultValue: 'master', description: 'https://jenkins.gtest.sahibindenlocal.net/jenkins/userContent/Tags', name: 'BRANCH', trim: true
            }
     */

    tools
            {
                maven 'Maven 3.6.3'
            }

    options
            {
                ansiColor('xterm')
            }

    stages {

        stage('Environment Info')
                {
                    steps
                            {
                                sh label: 'echo workspace', script: "echo ${WORKSPACE}"
                                sh label: 'export maven', script: EXPORT_MAVEN_HOME
                                sh label: 'java version', script: "java --version"
                                sh label: 'maven version', script: "mvn --version"
                            }
                }

        stage('Test Execute')
                {
                    steps
                            {
                                sh label: 'execute', script: "mvn clean install surefire:test -Dtest=SahibindenDemo -Djunit.jupiter.execution.parallel.config.fixed.parallelism=5"
                            }
                }

        stage('Test Result')
                {
                    steps
                            {
                                sh label: 'execute', script: "mvn allure:serve"
                            }
                }
    }

    post
            {

                always
                        {
                            sh label: 'Finished', script: "echo finisned"
                        }
            }
}